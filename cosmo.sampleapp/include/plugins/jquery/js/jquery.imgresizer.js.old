/* 
	imageScale plugin
	Description: Resizes images to a specifid size and overlays them with a hover tooltip containing link to the original full size image.
	Original resize plugin code from: http://ditio.net/2010/01/02/jquery-image-resize-plugin/
	Author: Harshal Joshi (harshalj@live.com)
	Version: 1.0.1
*/

(function ($) {
	$.fn.imageScale = function (options) {

		var settings = $.extend({
			scale: 1,
			maxWidth: null,
			maxHeight: null
		}, options);
	
		return this.each(function () {
			
			if (this.tagName.toLowerCase() != "img") {
				// Only images can be resized
				return $(this);
			}

			var width = this.naturalWidth;
			var height = this.naturalHeight;
			if (!width || !height) {
				// IE fix
				var img = document.createElement('img');
				img.src = this.src;

				width = img.width;
				height = img.height;
			}

			if (settings.scale != 1) {
				width = width * settings.scale;
				height = height * settings.scale;
			}

			var pWidth = 1;
			if (settings.maxWidth != null) {
				pWidth = width / settings.maxWidth;
			}
			var pHeight = 1;
			if (settings.maxHeight != null) {
				pHeight = height / settings.maxHeight;
			}
			var reduce = 1;

			if (pWidth < pHeight) {
				reduce = pHeight;
			} else {
				reduce = pWidth;
			}

			if (reduce < 1) {
				reduce = 1;
			}

			var newWidth = width / reduce;
			var newHeight = height / reduce;

			return $(this)
				.attr("width", newWidth)
				.attr("height", newHeight);
		});
	}
})(jQuery);

